import{d as e,q as a,bG as t,r as l,bL as r,a as s,g as p,c6 as o,h as n,bc as d,aG as u,o as i,c,w as y,A as v,b as m,y as _,z as f,u as x,F as g,ac as b,V as h,W as S,ai as k,E as w,f as C,t as T,i as I,ah as P,C as R,_ as j}from"./index-06110d51.js";import{p as E,g as G}from"./pay.79dd7250.js";const O=j(e({__name:"pay",emits:["close"],setup(e,{expose:j,emit:O}){a()&&t.init();const z=l(!1),A=l(!1),H=l(null),U=l(""),$=()=>{var e,l;uni.$u.test.isEmpty(U.value)?T({title:g("pay.notHavePayType"),icon:"none"}):A.value||(A.value=!0,E({trade_type:null==(e=H.value)?void 0:e.trade_type,trade_id:null==(l=H.value)?void 0:l.trade_id,type:U.value,openid:uni.getStorageSync("openid")||""}).then((e=>{var l,r,p,o,n,d;switch(U.value){case"wechatpay":a()?(e.data.timestamp=e.data.timeStamp,delete e.data.timeStamp,t.pay({...e.data,success:()=>{F()},cancel:()=>{A.value=!1}})):(uni.setStorageSync("paymenting",{trade_type:null==(l=H.value)?void 0:l.trade_type,trade_id:null==(r=H.value)?void 0:r.trade_id}),location.href=e.data.h5_url);break;case"alipay":a()?s({url:"/app/pages/pay/browser",param:{trade_type:null==(p=H.value)?void 0:p.trade_type,trade_id:null==(o=H.value)?void 0:o.trade_id,alipay:encodeURIComponent(e.data.url)},mode:"redirectTo"}):(uni.setStorageSync("paymenting",{trade_type:null==(n=H.value)?void 0:n.trade_type,trade_id:null==(d=H.value)?void 0:d.trade_id}),location.href=e.data.url);break;default:if(e.data.url)return void s({url:e.data.url,param:e.data.param||{},mode:"redirectTo"});F()}})).catch((()=>{A.value=!1})))};r("checkIsReturnAfterPayment",(()=>{const e=uni.getStorageSync("paymenting");uni.getStorageSync("paymenting")&&s({url:"/app/pages/pay/result",param:{trade_type:e.trade_type,trade_id:e.trade_id},mode:"redirectTo",success(){uni.removeStorageSync("paymenting")}})}));const q=l(!1),F=()=>{var e,a;s({url:"/app/pages/pay/result",param:{trade_type:null==(e=H.value)?void 0:e.trade_type,trade_id:null==(a=H.value)?void 0:a.trade_id},mode:"redirectTo"})},L=()=>{uni.removeStorageSync("paymenting"),z.value=!1,O("close")};return j({open:(e,a,t="")=>{q.value||(q.value=!0,uni.setStorageSync("payReturn",encodeURIComponent(t)),G(e,a).then((e=>{let{data:a}=e;H.value=a,uni.$u.test.isEmpty(a)?T({title:g("pay.notObtainedInfo"),icon:"none"}):0!=a.money?(U.value=a.pay_type_list[0]?a.pay_type_list[0].key:"",z.value=!0,q.value=!1):F()})).catch((()=>{q.value=!1})))}}),(e,a)=>{const t=I,l=p(n("u-image"),o),r=p(n("u-icon"),d),s=P,T=R,j=p(n("u-popup"),u);return i(),c(j,{show:z.value,round:10,onClose:L,closeable:!0,bgColor:"#fff",zIndex:"10081",closeOnClickOverlay:!1},{default:y((()=>[H.value?(i(),c(t,{key:0,class:"flex flex-col h-[75vh] popup-common",onTouchmove:a[0]||(a[0]=v((()=>{}),["prevent","stop"]))},{default:y((()=>[m(t,{class:"head"},{default:y((()=>[m(t,{class:"title"},{default:y((()=>[_(f(x(g)("pay.payTitle")),1)])),_:1}),m(t,{class:"flex items-end justify-center w-full text-xl font-bold py-[20rpx] price-font"},{default:y((()=>[m(t,{class:"text-base mr-[4rpx]"},{default:y((()=>[_(f(x(g)("currency")),1)])),_:1}),_(" "+f(x(b)(H.value.money)),1)])),_:1})])),_:1}),m(s,{"scroll-y":"true",class:"flex-1 pt-[20rpx]"},{default:y((()=>[m(t,{class:"flex text-[28rpx] px-[36rpx] py-[20rpx] mb-[10rpx]"},{default:y((()=>[m(t,{class:"text-[var(--text-color-light6)]"},{default:y((()=>[_(f(x(g)("pay.orderInfo")),1)])),_:1}),m(t,{class:"text-right flex-1 pl-[30rpx] truncate"},{default:y((()=>[_(f(H.value.body),1)])),_:1})])),_:1}),m(t,{class:"mx-[var(--popup-sidebar-m)] px-[30rpx] bg-white rounded-[20rpx] bg-[var(--temp-bg)]"},{default:y((()=>[H.value.pay_type_list.length?(i(!0),h(S,{key:0},k(H.value.pay_type_list,((e,a)=>(i(),c(t,{class:"pay-item py-[30rpx] flex items-center border-0 border-b border-solid border-[#eee]",key:a,onClick:a=>U.value=e.key},{default:y((()=>[m(l,{src:x(w)(e.icon),width:"50rpx",height:"50rpx"},null,8,["src"]),m(t,{class:"flex-1 px-[20rpx] text-[28rpx] font-500"},{default:y((()=>[_(f(e.name),1)])),_:2},1024),e.key==U.value?(i(),c(r,{key:0,name:"checkbox-mark",color:"var(--primary-color)"})):C("v-if",!0)])),_:2},1032,["onClick"])))),128)):(i(),c(t,{key:1,class:"py-[30rpx] text-center text-[24rpx] text-gray-subtitle"},{default:y((()=>[_(f(x(g)("pay.notHavePayType")),1)])),_:1}))])),_:1})])),_:1}),m(t,{class:"btn-wrap"},{default:y((()=>[m(T,{class:"primary-btn-bg btn","hover-class":"none",loading:A.value,onClick:$},{default:y((()=>[_(f(x(g)("pay.confirmPay")),1)])),_:1},8,["loading"])])),_:1})])),_:1})):C("v-if",!0)])),_:1},8,["show"])}}}),[["__scopeId","data-v-adb3a49d"]]);export{O as _};

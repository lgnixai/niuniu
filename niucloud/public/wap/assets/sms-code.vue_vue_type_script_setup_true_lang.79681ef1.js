import{r as e,F as a,j as t,a4 as o,a5 as c,d as n,O as l,g as s,a6 as r,h as i,R as u,a7 as d,o as m,V as h,b as p,w as f,y as g,z as v,u as y,X as x,W as C,t as _,i as b,B as w}from"./index-06110d51.js";function V(a){const t=e("");return{image:t,refresh:async()=>{try{const e=await c();a.captcha_key=e.data.captcha_key,a.captcha_code="",t.value=e.data.img.replace(/\r\n/g,"")}catch(e){}}}}const k=n({__name:"sms-code",props:{mobile:String,type:String,isAgree:{type:Boolean,default:!0},modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(c,{emit:n}){const k=c,G=t({get:()=>k.modelValue,set(e){n("update:modelValue",e)}}),T=e(null),S=function(c){const n=e(a("getSmsCode")),l="X"+a("smsCodeChangeText"),s=t((()=>!c.value||c.value.canGetCode));return{tips:n,seconds:90,canGetCode:s,send:async e=>{if(!s.value)return;c.value.start();let a=!1;return await o(e).then((e=>{1==e.code?a=e.data.key:(c.value.reset(),a=!1)})).catch((e=>{a=!1,c.value.reset()})),a},codeChange:e=>{n.value=e},changeText:l}}(T),A=e(!1),E=l({mobile:"",captcha_code:"",captcha_key:"",type:k.type}),P=V(E),$=async()=>{if(T.value.canGetCode){if(E.mobile=k.mobile,!k.isAgree)return void _({title:a("isAgreeTips"),icon:"none"});if(uni.$u.test.isEmpty(E.mobile))return void _({title:a("mobilePlaceholder"),icon:"none"});if(!uni.$u.test.mobile(E.mobile))return void _({title:a("mobileError"),icon:"none"});await P.refresh(),A.value=!0}},j=async()=>{if(uni.$u.test.isEmpty(E.captcha_code))return void _({title:a("captchaPlaceholder"),icon:"none"});const e=await S.send(E);e?(G.value=e,A.value=!1):!1===e&&P.refresh()};return(e,t)=>{const o=b,c=s(i("u-code"),r),n=s(i("u-input"),u),l=w,_=s(i("u-modal"),d);return m(),h(C,null,[p(o,{class:x(["text-[26rpx]",{"text-primary":y(S).canGetCode.value,"text-gray-300":!y(S).canGetCode.value}]),onClick:$},{default:f((()=>[g(v(y(S).tips.value),1)])),_:1},8,["class"]),p(c,{seconds:y(S).seconds,"change-text":y(S).changeText,ref_key:"smsRef",ref:T,onChange:y(S).codeChange},null,8,["seconds","change-text","onChange"]),p(_,{show:A.value,title:y(a)("captchaTitle"),"confirm-text":y(a)("confirm"),"cancel-text":y(a)("cancel"),"show-cancel-button":!0,onCancel:t[2]||(t[2]=e=>A.value=!1),onConfirm:j,confirmColor:"var(--primary-color)"},{default:f((()=>[p(o,{class:"flex mt-[20rpx]"},{default:f((()=>[p(n,{placeholder:y(a)("captchaPlaceholder"),border:"surround",modelValue:E.captcha_code,"onUpdate:modelValue":t[0]||(t[0]=e=>E.captcha_code=e)},null,8,["placeholder","modelValue"]),p(l,{src:y(P).image.value,class:"h-[76rpx] w-[auto] ml-[20rpx]",mode:"heightFix",onClick:t[1]||(t[1]=e=>y(P).refresh())},null,8,["src"])])),_:1})])),_:1},8,["show","title","confirm-text","cancel-text"])],64)}}});export{k as _,V as u};

import{d as e,r as t,p as a,x as l,s,t as r,$ as c,a0 as x,a as i,o as u,c as p,w as n,V as d,b as o,u as f,y as m,W as v,ai as g,z as _,f as h,n as y,D as b,i as w,B as j,g as k,h as T,E as C,X as z}from"./index-06110d51.js";import{_ as E}from"./loading-page.vue_vue_type_script_setup_true_lang.29ba0e53.js";import{g as F,a as V,v as B}from"./verify.b0e55e0d.js";const D=e({__name:"verify",setup(e){const D=t(!0),H=t("");a((e=>{if(e.code&&(H.value=e.code),e.scene){let t=decodeURIComponent(e.scene).split("&");t.length&&t.forEach((e=>{-1!=e.indexOf("code")&&(H.value=e.split("-")[1])}))}})),l((()=>{s()&&(I(),O())}));const I=()=>{F().then((e=>{e.data?D.value=!1:(r({title:"非核销员无此权限",icon:"none"}),setTimeout((()=>{c().length>1?x({delta:1}):i({url:"/app/pages/member/index",mode:"reLaunch"})}),1e3))}))},L=t({}),O=()=>{D.value=!0,V(H.value).then((e=>{L.value=e.data,D.value=!1})).catch((()=>{setTimeout((()=>{D.value=!1,i({url:"/app/pages/verify/index",param:{},mode:"redirectTo"})}),1e3)}))};let R=!1;const U=()=>{if(R)return!1;R=!0,B(H.value).then((e=>{r({title:"核销成功",icon:"none"}),setTimeout((()=>{R=!1,i({url:"/app/pages/verify/index",param:{},mode:"redirectTo"})}),1e3)})).catch((()=>{R=!1}))};return(e,t)=>{const a=b,l=w,s=j,r=k(T("loading-page"),E);return u(),p(l,{style:y(e.themeColor()),class:"bg-[var(--page-bg-color)] min-h-[100vh] overflow-hidden"},{default:n((()=>[!D.value&&L.value&&L.value.value?(u(),d(v,{key:0},[o(l,{class:"p-[30rpx] bg-[#fff]"},{default:n((()=>[o(l,{class:"text-[var(--primary-color)] fixed top-[40rpx] right-[30rpx] flex items-center",onClick:t[0]||(t[0]=e=>f(i)({url:"/app/pages/verify/record"}))},{default:n((()=>[o(a,{class:"nc-iconfont nc-icon-lishijiluV6xx !text-[28rpx] -mb-[2rpx]"}),o(a,{class:"text-[26rpx] ml-[8rpx]"},{default:n((()=>[m("核销记录")])),_:1})])),_:1}),o(l,{class:"flex items-center mt-[60rpx] justify-center"},{default:n((()=>[o(l,{class:"flex justify-center items-center flex-col pr-[30rpx]"},{default:n((()=>[o(s,{class:"w-[100rpx] h-[100rpx]",src:f(C)("static/resource/images/verify/yanzhenghexiaoma.png")},null,8,["src"]),o(l,{class:"text-[26rpx] mt-[14rpx] h-[36rpx] leading-[36rpx] flex-shrink-0"},{default:n((()=>[m("验证核销码")])),_:1})])),_:1}),o(s,{class:"w-[74rpx] h-[12rpx] mb-[50rpx]",src:f(C)("static/resource/images/verify/youjiantou.png")},null,8,["src"]),o(l,{class:"flex justify-center items-center flex-col pl-[30rpx]"},{default:n((()=>[o(s,{class:"w-[100rpx] h-[100rpx]",src:f(C)("static/resource/images/verify/hexiao.png")},null,8,["src"]),o(l,{class:"text-[26rpx] mt-[14rpx] h-[36rpx] leading-[36rpx] flex-shrink-0"},{default:n((()=>[m("确定核销")])),_:1})])),_:1})])),_:1})])),_:1}),o(l,{class:"card-template mt-[var(--top-m)] sidebar-margin"},{default:n((()=>[(u(!0),d(v,null,g(L.value.value.list,((e,t)=>(u(),p(l,{class:z(["flex",{"mb-[var(--top-m)]":L.value.value.list.length-1!=t}]),key:t},{default:n((()=>[e.cover?(u(),p(s,{key:0,class:"w-[150rpx] h-[150rpx] rounded-[var(--goods-rounded-big)]",mode:"aspectFill",src:f(C)(e.cover)},null,8,["src"])):(u(),p(s,{key:1,class:"w-[150rpx] h-[150rpx] rounded-[var(--goods-rounded-big)]",mode:"aspectFill",src:f(C)("addon/tourism/tourism/member/hotel.png")},null,8,["src"])),o(l,{class:"flex flex-col flex-1 ml-[20rpx] py-[4rpx]"},{default:n((()=>[o(l,{class:"leading-[1]"},{default:n((()=>[o(l,{class:"leading-[40rpx] truncate max-w-[490rpx] text-[28rpx]"},{default:n((()=>[m(_(e.name),1)])),_:2},1024),e.sub_name?(u(),p(l,{key:0,class:"mt-[14rpx] truncate text-[24rpx] text-[var(--text-color-light9)] leading-[28rpx] max-w-[490rpx]"},{default:n((()=>[m(_(e.sub_name),1)])),_:2},1024)):h("v-if",!0)])),_:2},1024),o(l,{class:"text-[var(--text-color-light6)] text-[28rpx] mt-[20rpx]"},{default:n((()=>[m("x1")])),_:1})])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1}),o(l,{class:"card-template mt-[var(--top-m)] sidebar-margin"},{default:n((()=>[o(l,{class:"title"},{default:n((()=>[m("核销信息")])),_:1}),o(l,{class:"card-template-item justify-between"},{default:n((()=>[o(a,{class:"text-[28rpx] text-[#333]"},{default:n((()=>[m("核销类型")])),_:1}),o(l,{class:"text-[28rpx] text-[#333]"},{default:n((()=>[m(_(L.value.type_name),1)])),_:1})])),_:1}),(u(!0),d(v,null,g(L.value.value.content.fixed,((e,t)=>(u(),p(l,{class:"card-template-item justify-between"},{default:n((()=>[o(a,{class:"text-[28rpx] text-[#333]"},{default:n((()=>[m(_(e.title),1)])),_:2},1024),o(l,{class:"text-[28rpx] text-[#333]"},{default:n((()=>[m(_(e.value),1)])),_:2},1024)])),_:2},1024)))),256))])),_:1}),(u(!0),d(v,null,g(L.value.value.content.diy,((e,t)=>(u(),p(l,{key:t,class:"card-template mt-[var(--top-m)] sidebar-margin"},{default:n((()=>[o(l,{class:"title"},{default:n((()=>[m(_(e.title),1)])),_:2},1024),(u(!0),d(v,null,g(e.list,((e,t)=>(u(),p(l,{class:"card-template-item justify-between",key:t},{default:n((()=>[o(a,{class:"text-[28rpx] text-[#333]"},{default:n((()=>[m(_(e.title),1)])),_:2},1024),o(a,{class:"text-[28rpx] text-[#333]"},{default:n((()=>[m(_(e.value),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)))),128)),o(l,{class:"fixed bottom-[30rpx] primary-btn-bg text-[#fff] flex-center !text-[26rpx] rounded-[50rpx] h-[80rpx] left-[20rpx] right-[20rpx] font-500",onClick:U},{default:n((()=>[m("确定")])),_:1})],64)):h("v-if",!0),o(r,{loading:D.value},null,8,["loading"])])),_:1},8,["style"])}}});export{D as default};

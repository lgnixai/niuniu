import{d as e,r as a,g as t,aG as s,h as l,o,V as n,f as p,b as u,w as r,A as c,n as i,c as d,u as f,E as v,y as m,W as h,bS as y,c5 as _,B as g,i as b,D as w,C as x,_ as C}from"./index-06110d51.js";const S=C(e({__name:"share-poster",props:{posterId:{type:String||Number,default:0},posterType:{type:String,default:""},posterParam:{type:Object,default:{}},copyUrl:{type:String,default:""},copyUrlParam:{type:String,default:""}},emits:["close"],setup(e,{expose:C,emit:S}){const P=e,U=a(!1),k=()=>{let e="";if(P.copyUrl){let a=location.pathname,t=["/app/","/addon/"];for(let e=0;e<t.length;e++)-1!=a.indexOf(t[e])&&(a=a.substr(0,a.indexOf(t[e])));e=location.origin+a+P.copyUrl+P.copyUrlParam}else e=location.origin+location.pathname+P.copyUrlParam;y(e,(()=>{U.value=!1}))},D=a(!1),O=a(!1),T=a(""),j=()=>{D.value=!0,O.value=!1;let e={id:P.posterId,type:P.posterType,param:P.posterParam},a=Date.parse(new Date);_(e).then((e=>{T.value=e.data&&v(e.data)||"";let t=Date.parse(new Date)-a;t<2200?setTimeout((()=>{D.value=!1,O.value=!0}),2200-t):(D.value=!1,O.value=!0)})).catch((()=>{A()}))},I=a(!1),z=()=>{I.value=!1},F=a(0),A=()=>{U.value=!1,D.value=!1,O.value=!1,console.log("sharePopupClose 取消分享"),S("close")};return C({openShare:()=>{U.value=!0,j()}}),(e,a)=>{const y=g,_=b,C=w,S=x,P=t(l("u-popup"),s);return o(),n(h,null,[p(" 分享弹窗 "),u(_,{onTouchmove:a[2]||(a[2]=c((()=>{}),["prevent","stop"])),class:"share-popup"},{default:r((()=>[u(P,{show:U.value,type:"bottom",onClose:A,overlayOpacity:"0.8"},{default:r((()=>[u(_,{onTouchmove:a[0]||(a[0]=c((()=>{}),["prevent","stop"]))},{default:r((()=>[u(_,{class:"poster-img-wrap",style:i({top:F.value})},{default:r((()=>[D.value?(o(),d(y,{key:0,class:"poster-animation",src:f(v)("addon/shop/poster_animation.gif"),mode:"aspectFit"},null,8,["src"])):p("v-if",!0),O.value?(o(),d(y,{key:1,class:"poster-img",src:f(v)(T.value),mode:"aspectFit","show-menu-by-longpress":!0},null,8,["src"])):p("v-if",!0)])),_:1},8,["style"]),u(_,{class:"share-content"},{default:r((()=>[u(_,{class:"share-box",onClick:k},{default:r((()=>[u(S,{class:"share-btn",plain:!0},{default:r((()=>[u(_,{class:"text-[#07c160] iconfont iconfuzhilianjie"}),u(C,null,{default:r((()=>[m("复制链接")])),_:1})])),_:1})])),_:1})])),_:1}),u(_,{class:"share-footer",onClick:A},{default:r((()=>[u(C,null,{default:r((()=>[m("取消分享")])),_:1})])),_:1})])),_:1})])),_:1},8,["show"]),u(P,{show:I.value,mode:"center",round:10,closeable:!0,onClose:a[1]||(a[1]=e=>I.value=!1),"safe-area-inset-bottom":!1},{default:r((()=>[u(_,{class:"dialog-popup"},{default:r((()=>[u(_,{class:"title"},{default:r((()=>[m("提示")])),_:1}),u(_,{class:"message"},{default:r((()=>[m("您拒绝了保存图片到相册的授权请求，无法保存图片到相册，如需正常使用，请授权之后再进行操作。")])),_:1}),u(_,{class:"action-wrap"},{default:r((()=>[u(_,{onClick:z},{default:r((()=>[m("取消")])),_:1}),u(_,null,{default:r((()=>[u(S,{type:"default",class:"authorization-btn","open-type":"openSetting",onOpensetting:z,"hover-class":"none"},{default:r((()=>[m("立即授权")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})],2112)}}}),[["__scopeId","data-v-b40c0a9d"]]);export{S as _};
